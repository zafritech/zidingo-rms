<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"
      layout:decorator="layouts/main">

    <head>
        <title>Zidingo RMS</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="UTF-8" />
    </head>

    <body>

        <div layout:fragment="content">

            <div class="col-lg-12" style="padding-left: 0px;">
                <h1 class="page-header">
                    <span  th:text="${artifact.artifactLongName}">Artifact</span>
                </h1>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <h4 th:text="${artifact.identifier}">Project name</h4>
                    <h4 th:text="${artifact.artifactProject.projectName}">Project name</h4>
                </div>
                <div class="col-md-6" style="padding-right: 20px;">
                    <div th:if="${items.isEmpty()}" class="pull-right" >
                        <a th:href="@{'/artifacts/metadata/' + ${artifact.id}}"><i class="fa fa-fw fa-list"></i> Metadata</a> |
                        <a href="#createItemModal" data-toggle="modal" data-ref-item-idx="0" data-ref-pos="ABOVE"><i class="fa fa-fw fa-pencil"></i> Create Item</a> |
                        <a href="#editItemModal" data-toggle="modal" data-item-id=""><i class="fa fa-fw fa-sitemap"></i> Apply Template</a> |
                        <a href="#importExcelModal" role="button" data-toggle="modal"><i class="fa fa-fw fa-file-excel-o"></i> Import Excel</a>
                    </div>
                    <div th:if="${!items.isEmpty()}" class="pull-right" >
                        <a th:href="@{'/artifacts/metadata/' + ${artifact.id}}"><i class="fa fa-fw fa-list"></i> Metadata</a>
                        <a th:href="@{'/pdf/download/' + ${artifact.id}}"><i class="fa fa-fw fa-file-pdf-o"></i> Download PDF</a>
                        <a th:href="@{'/excel/download/' + ${artifact.id}}"><i class="fa fa-fw fa-file-excel-o"></i> Download Excel</a>
                    </div>
                </div>
            </div>

            <div th:if="${items.isEmpty()}">

                <div id="artifactEmpty" class="row">
                    <div class="col-lg-6 col-lg-offset-2" style="margin-top: 100px;">

                        <div class="text-center" style="color: #c0c0c0;">
                            <i class="fa fa-gears fa-5x"></i>
                        </div>
                        <div class="text-center" style="color: #c0c0c0;">
                            <h3>This document is empty.</h3>
                            <br/>
                            <h5>User menus above to create or import document contents.</h5>
                        </div>
                    </div>
                </div>

                <div id="artifactLoading" class="row hidden">
                    <div class="col-lg-6 col-lg-offset-2" style="margin-top: 100px;">

                        <div class="text-center" style="color: #c0c0c0;">
                            <i class="fa fa-spinner fa-4x fa-spin"></i>
                        </div>
                        <div class="text-center" style="color: #c0c0c0;">
                            <h3>Importing from Excel...</h3>
                        </div>
                    </div>
                </div>

            </div>

            <div th:if="${!items.isEmpty()}" class="panel-body">

                <div th:each="item : ${items}" 
                     th:attr="id=${item.sysId}" 
                     th:classappend="${item.itemClass == 'HEADER'} ? 'row item-header-' + ${item.itemLevel} : 'row item-level-' + ${item.itemLevel} + ' ' + ${#strings.toLowerCase(item.itemClass)}">
                    <div th:attr="id='value-container-'+${item.sysId}" th:class="${item.itemClass} == 'REQUIREMENT' ? 'col-xs-9 requirement-text' : 'col-xs-11'">
                        <span th:attr="id='value-'+${item.sysId}"  th:utext="${#strings.replace(item.itemValue, newLineChar, '&lt;br /&gt;')}">Item</span>
                    </div>
                    <div th:attr="id='ident-container-'+${item.sysId}" th:if="${item.itemClass} == 'REQUIREMENT'" class="col-xs-2 requirement-identifier">
                        <span th:attr="id='ident-'+${item.sysId}" th:text="${item.identifier}">Identifier</span>
                    </div>
                    <div th:attr="id='menu-container-'+${item.sysId}" class="btn-group pull-right normal-text">

                        <!-- Item Menu <ul> Container -->
                        <ul class="item-toolbar-ul">  

                            <li class="dropdown item-toolbar-li" th:if="${item.commentCount} > 0">
                                <a href="javascript:void(0);" th:onclick="'javascript:BootboxItemComments(\'' + ${item.id} + '\');'">
                                    <i class="fa fa-comments" style="color: #00aced; font-size: 22px;"></i> 
                                </a>
                            </li>

                            <li class="dropdown item-toolbar-li" style="margin-right: -10px;">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                   <i class="fa fa-angle-double-right" style="color: #00aced; font-size: 18px;"></i>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-right" role="menu">
                                    <li>
                                        <a href="#createItemModal" data-toggle="modal" th:attr="data-ref-item-idx=${item.sortIndex}, data-ref-item-sys-id=${item.sysId}, data-ref-item-id=${item.id}" data-ref-pos="BELOW"><i class="fa fa-fw fa-level-down"></i> Add item below</a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" th:onclick="'javascript:BootboxCreateItemBelow(\'' + ${item.id} + '\',\'' + ${item.sortIndex} + '\');'"><i class="fa fa-fw fa-level-down"></i> Add item below [DEV]</a>
                                    </li>
                                    <li>
                                        <a href="#createItemModal" data-toggle="modal" th:attr="data-ref-item-idx=${item.sortIndex}, data-ref-item-sys-id=${item.sysId}, data-ref-item-id=${item.id}" data-ref-pos="ABOVE"><i class="fa fa-fw fa-level-up"></i> Add item above</a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" th:onclick="'javascript:moveItemUp(\'' + ${item.id} + '\');'"><i class="fa fa-fw fa-chevron-circle-up"></i> Move item up</a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" th:onclick="'javascript:moveItemDown(\'' + ${item.id} + '\');'"><i class="fa fa-fw fa-chevron-circle-down"></i> Move item down</a>
                                    </li>
                                    <li>
                                        <a href="#editItemModal" data-toggle="modal" th:attr="data-item-id=${item.id}"><i class="fa fa-fw fa-pencil"></i> Edit item</a>
                                    </li>
                                    <li th:if="${item.itemClass} == 'REQUIREMENT'" class="divider"></li>
                                    <li th:if="${item.itemClass} == 'REQUIREMENT'">
                                        <a href="#editItemModal" data-toggle="modal" th:attr="data-item-id=${item.id}"><i class="fa fa-fw fa-link"></i> Item Links</a>
                                    </li>
                                    <li th:if="${item.itemClass} == 'REQUIREMENT'">
                                        <a href="javascript:void(0);" th:onclick="'javascript:BootboxAddComment(\'' + ${item.id} + '\');'"><i class="fa fa-fw fa-comments"></i> Add item comment</a>
                                    </li>
                                    <li th:if="${item.itemClass} == 'REQUIREMENT'">
                                        <a href="#editItemModal" data-toggle="modal" th:attr="data-item-id=${item.id}"><i class="fa fa-fw fa-tasks"></i> Item attributes</a>
                                    </li>
                                    <li class="divider"></li>
                                    <li>
                                        <a href="#"><i class="fa fa-fw fa-trash"></i> Delete item</a>
                                    </li>
                                </ul>
                            </li>

                        </ul>

                    </div>
                </div>

            </div>

            <!-- Import from Excel modal ############################################ -->
            <div class="modal fade" id="importExcelModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                            <h3 class="modal-title" id="lineModalLabel">Import from Excel file</h3>
                        </div>
                        <div class="modal-body">

                            <!-- content goes here -->
                            <form id="importExcel" action="/excel/import" method="post" enctype="multipart/form-data">

                                <div class="form-group">
                                    <label for="excelfile">Excel file</label>
                                    <input type="file" class="form-control" id="file" name="file" placeholder="Select Excel file" />
                                </div>

                                <input type="hidden" name="artifactId" id="artifactId" th:value="${artifact.id}" />

                            </form>

                        </div>

                        <div class="modal-footer">
                            <div class="btn-group btn-group-justified" role="group" aria-label="group button">
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-danger" data-dismiss="modal"  role="button">Cancel</button>
                                </div>
                                <div class="btn-group btn-delete hidden" role="group">
                                    <button type="button" id="delImage" class="btn btn-default btn-hover-red" data-dismiss="modal"  role="button">Delete</button>
                                </div>
                                <div class="btn-group" role="group">
                                    <button type="button" id="importFromFile" class="btn btn-success btn-hover-green" onclick="document.getElementById('importExcel').submit();" data-dismiss="modal" role="button">Import</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Create New Requirement modal ############################################ -->
            <div class="modal fade" id="createItemModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                            <h3 class="modal-title" id="lineModalLabel">Create New Item</h3>
                        </div>
                        <div class="modal-body">

                            <!-- content goes here -->
                            <form id="createItem" action="/api/items/save" method="post">

                                <input type="hidden" name="artifactId" id="artifactId" value="" />
                                <!--<input type="hidden" name="sysIdTemplate" id="sysIdTemplate" value="QEC-APPXC" />-->
                                <input type="hidden" name="createId" id="createId" value="" />
                                <input type="hidden" name="createSortIndex" id="createSortIndex" value="" />
                                <input type="hidden" name="createInsertBefore" id="createInsertBefore" value="" />
                                <input type="hidden" name="createInsertAfter" id="createInsertAfter" value="" />

                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="createItemLevel">Item level:</label>
                                            <select class="form-control" id="createItemLevel" name="createItemLevel"></select>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="createItemClass">Item class:</label>
                                            <select class="form-control" id="createItemClass" name="createItemClass" onchange="itemCreateClassChange();"></select>
                                        </div>
                                    </div>
                                </div>

                                <div class="row" id="createRequirementRow">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="createItemType">Requirement type:</label>
                                            <select class="form-control" id="createItemType" name="createItemType"></select>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="createIdentTemplate">Identifier prefix:</label>
                                            <select class="form-control" id="createIdentTemplate" name="createIdentTemplate" onchange="itemCreateIdentTemplateChange();"></select>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="createMediaType">Media type:</label>
                                            <select class="form-control" id="createMediaType" name="createMediaType"></select>
                                        </div>
                                    </div>
                                    <div class="col-sm-6" id="createIdentifierContainer">
                                        <div class="form-group">
                                            <label for="createIdentifier">Identifier:</label>
                                            <input type="text" class="form-control" id="createIdentifier" name="createIdentifier" />
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="createItemValue">Item details:</label>
                                    <textarea class="form-control"  rows="5" cols="50" id="createItemValue" name="createItemValue"></textarea>
                                </div>

                            </form>

                        </div>
                        <div class="modal-footer">
                            <div class="btn-group btn-group-justified" role="group" aria-label="group button">
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-danger" data-dismiss="modal"  role="button">Cancel</button>
                                </div>
                                <div class="btn-group btn-delete hidden" role="group">
                                    <button type="button" id="delImage" class="btn btn-default btn-hover-red" data-dismiss="modal"  role="button">Delete</button>
                                </div>
                                <div class="btn-group" role="group">
                                    <button type="button" id="createItemSaveBtn" class="btn btn-success btn-hover-green" role="button">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit Requirement modal ##################################################################################################### -->
            <div class="modal fade" id="editItemModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                            <h3 class="modal-title" id="lineModalLabel">Edit Item</h3>
                        </div>
                        <div class="modal-body">

                            <!-- content goes here -->
                            <form id="editItem" action="/api/items/save" method="post">

                                <input type="hidden" name="artifactId" id="artifactId" value="" />
                                <input type="hidden" name="editId" id="editId" value="" />
                                <input type="hidden" name="editSysId" id="editSysId" value="" />
                                <input type="hidden" name="editSortIndex" id="editSortIndex" value="" />

                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="editItemLevel">Item level:</label>
                                            <select class="form-control" id="editItemLevel" name="editItemLevel"></select>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="editItemClass">Item class:</label>
                                            <select class="form-control" id="editItemClass" name="editItemClass" onchange="itemEditClassChange();"></select>
                                        </div>
                                    </div>
                                </div>

                                <div class="row" id="editRequirementRow">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="editItemType">Requirement type:</label>
                                            <select class="form-control" id="editItemType" name="editItemType"></select>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="createIdentTemplate">Identifier prefix:</label>
                                            <select class="form-control" id="editIdentTemplate" name="editIdentTemplate" onchange="itemEditIdentTemplateChange();"></select>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="createMediaType">Media type:</label>
                                            <select class="form-control" id="editMediaType" name="editMediaType"></select>
                                        </div>
                                    </div>
                                    <div class="col-sm-6" id="editIdentField">
                                        <div class="form-group">
                                            <label for="editIdentifier">Identifier:</label>
                                            <input type="text" class="form-control" id="editIdentifier" name="editIdentifier" />
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="editItemValue">Item details:</label>
                                    <textarea class="form-control"  rows="5" cols="50" id="editItemValue" name="editItemValue"></textarea>
                                </div>

                            </form>

                        </div>
                        <div class="modal-footer">
                            <div class="btn-group btn-group-justified" role="group" aria-label="group button">
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-danger" data-dismiss="modal"  role="button">Cancel</button>
                                </div>
                                <div class="btn-group btn-delete hidden" role="group">
                                    <button type="button" id="delImage" class="btn btn-default btn-hover-red" data-dismiss="modal"  role="button">Delete</button>
                                </div>
                                <div class="btn-group" role="group">
                                    <button type="button" id="editItemSaveBtn" class="btn btn-success btn-hover-green" role="button">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </body>

    <th:block layout:fragment="scripts"></th:block>

</html>